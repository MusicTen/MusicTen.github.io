# JavaScript 闭包

- 什么是闭包? 
  - 简单来说， 闭包就是能够读取其他函数内部变量的函数，在本质上，闭包是将函数内部和函数外部连接起来的桥梁。例如在javascript中，只有函数内部的子函数才能读取局部变量，所以闭包可以理解成“定义在一个函数内部的函数“。
  - 闭包是 JS 函数作用域的副产品。

- 为什么需要闭包？ 
  - 局部变量无法共享和长久的保存，而全局变量可能造成变量污染，所以我们希望有一种机制既可以长久的保存变量又不会造成全局污染。

- 何时使用？ 
  - 变量既想反复使用，又想避免全局污染

- 如何使用？ 
  - 定义外层函数，封装被保护的局部变量。
  - 定义内层函数，执行对外部函数变量的操作。
  - 外层函数返回内层函数的对象，并且外层函数被调用，结果保存在一个全局的变量中。

- 缺点： 
  - 占用更多内存
  - 不容易被释放

- 怎么解决闭包的内存泄漏？ 
  - 严格说起来不算是闭包的问题，主要是因为`ie`的bug，`ie`在我们使用完闭包之后，依然回收不了闭包里面引用的变量。

- 什么是内存泄露？ 

  - 定义：一块被分配的内存既不能使用，也不能回收。从而影响性能，甚至导致程序崩溃。**通俗来说，内存泄露是指你用不到（访问不到）的变量，依然占居着内存空间，不能被再次利用起来**。
  - 起因：JavaScript的垃圾自动回收机制会按一定的策略找出那些不再继续使用的变量，释放其占有的内存。然而由于一些原因导致在这种机制下内存管理器不能正确解读JavaScript变量的生命周期，从而没有释放其内存，而也没有再被使用。循环引用是导致以上情况的主要原因之一。

- 解决办法： 

  - 常用的解决方法就是在JavaScript代码段运行完之时将形成循环引用的JavaScript对象手动设置为空，切断引用。

    ```javascript
    function example() {
          var element = document.getElementByID("div1");  //div1用完之后一直驻留在内存中
          element.onclick = function() {
              alert("This is a leak!"); // 这里用div1导致内存泄露
          }
          // 添加的语句
          element = null;  // 最后应将div1解除引用来避免内存泄露
    }
    ```

    